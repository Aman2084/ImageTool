<?xml version="1.0" encoding="utf-8"?>
<!--Aman creat at 2018-9-18 下午4:06:33-->
<s:BorderContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx"  
		 xmlns:ui="ui.*" xmlns:border="com.border.*" 
		 backgroundAlpha="0"
		 creationComplete="init(event)" 
		 resize="onResize(event)">
	<fx:Script>
		<![CDATA[
			import com.aman.event.ZEvent;
			import com.border.Operation;
			
			import mx.events.FlexEvent;
			import mx.events.ResizeEvent;
			
			import tools.DirectorySelecter;
			import tools.ImageSelecter;
			import tools.MySaver;
			
			import ui.ImgCanvas;
			
			private var _selecter_dir:DirectorySelecter;
			private var _selecter_image:ImageSelecter;
			private var _saver:MySaver;
			private var _loader:Loader;
			
			[Bindable]
			private var _isCut:Boolean = true;
			
			private var img:ImgCanvas
			
			private function init(event:FlexEvent):void{
				img = img_cut
				
				_selecter_dir = new DirectorySelecter();
				_selecter_image = new ImageSelecter();
				_saver = new MySaver();
				_loader = new Loader();
				
				var a:Array = [Operation.SelectAddress , Operation.SelectImage , 
					Operation.Save , Operation.RealSize , Operation.ZoomSize , ZEvent.In , ZEvent.Out];
				for (var i:int = 0; i < a.length; i++){
					oper.addEventListener(a[i] , onOperation);
				}
				
				_selecter_image.addEventListener(Event.SELECT , onSelecter);
				_loader.contentLoaderInfo.addEventListener(Event.COMPLETE , onLoad);
				oper.addEventListener(ZEvent.Change , onChange);
				onResize();
			}
			
			//Listener
			private function onOperation($e:ZEvent):void{
				switch($e.type){
					case Operation.SelectAddress:
						_selecter_dir.browseForDirectory("请选取文件夹");
						break;
					case Operation.SelectImage:
						_selecter_image.selectImage();
						break
					case Operation.Save: 
						var b:BitmapData = img.getBmd();
						if(b){
							_saver.save(b , _selecter_image.name , _selecter_dir.nativePath);
						}
						break;
					case Operation.RealSize:
						img.displayType = ImageDisplay.RealSize;
						break;
					case Operation.ZoomSize:
						img.displayType = ImageDisplay.ZoomSize;
						break;
					case ZEvent.Out:
						_isCut = false;
						img = img_cut
						onChange(null)
						break;
					case ZEvent.In:
						_isCut = true;
						img = img_extension
						onChange(null)
						break;
				}
			}
			
			private function onChange($e:ZEvent):void{
				var r:Rectangle = $e.data as Rectangle;
				img.change(r);
			}
			
			private function onSelecter($e:Event):void{
				var r:URLRequest = new URLRequest(_selecter_image.nativePath);
				_loader.load(r)
			}
			
			
			private function onLoad($e:Event=null):void{
//				img.bitmapData = loader.bitmapData;
				var b:BitmapData = (_loader.content as Bitmap).bitmapData;
				img.bitmapData = b;
				oper.setSize(b.width , b.height)
			}
			
			private function onResize($e:ResizeEvent=null):void{
				if(this.initialized){
					img.setSize(this.width , this.height-60);
				}
			}


		]]>
	</fx:Script>
	
	<border:ImageCut id="img_cut" visible="{_isCut}"/>
	<border:ImageExtension id="img_extension" visible="{!_isCut}"/>
	<border:Operation id="oper"
					  bottom="0" width="100%" height="60"/>
</s:BorderContainer>
